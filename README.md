# CMA
Cumulative moving average on sparse data: implementation and tests (work in progress)

## Sparse data
By sparse data we mean time series, where events are rare enough, e.g. there is gaps (or empty values) between events.
![sparse data](img/sparse.png?raw=true "sparse data")

There is a lot of methods for analyzing such time series. We will describe cummulative moving window for calculating average data for the last events in the sample window.

![moving window](img/mw.png?raw=true "moving window")

## Number of events
To calculate number of events in window `W` we will use the following iterative formula:

![cma](http://latex.codecogs.com/gif.latex?N_%7Bn&plus;1%7D%20%3D%20N_%7Bn%7D%20-%20N_%7Bn%7D%5Ccdot%20%5Cfrac%7Bdt%7D%7BW%7D%20&plus;%201)

where `dt` is the time between last event and current, `N` - previous number of events, `Nn+1` - new approximate number after the last event

## Velocity

To calculate average velocity (V) in the sample window we should divide the number of events(`N`) on window size(`W`)

![velocity](http://latex.codecogs.com/gif.latex?V%3D%5Cfrac%7BN%7D%7BW%7D)

## Acceleration and higher order derivatives

It's also possible to calculate "average acceleration" (and higher order derivatives) using two (or more) moving windows

![acceleration](img/acc.png?raw=true "acceleration")

## Tests

There is two test comparing precise and cumulative moving average in sample window. Tests are generated by `cma_tests.c` program.

![constant acceleration](vconstacc.png?raw=true "test with constant acceleration")

![sine-alike](vsin.png?raw=true "test with sine alike events speed")
